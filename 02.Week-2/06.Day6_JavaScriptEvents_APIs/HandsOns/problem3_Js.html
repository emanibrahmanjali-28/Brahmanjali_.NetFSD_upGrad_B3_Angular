<!DOCTYPE html>
<html>
<head>
    <title>Location-Based Weather Logger</title>
</head>
<body>

    <h2>Location-Based Weather Logger</h2>

    <button onclick="getLocation()">Get My Location</button>

    <!-- Clear Button -->
    <button onclick="clearHistory()">Clear History</button>

    <h3>Current Location:</h3>
    <p id="currentLocation">No location fetched yet.</p>

    <h3>Location History (Last 5):</h3>
    <ul id="locationHistory"></ul>

    <script>

        // Load history when page loads
        window.onload = function() {
            displayHistory();
        };

        function getLocation() {

            if (navigator.geolocation) {

                navigator.geolocation.getCurrentPosition(
                    successCallback,
                    errorCallback,
                    { timeout: 5000 }
                );

            } else {
                document.getElementById("currentLocation").innerHTML =
                    "Geolocation is not supported by this browser.";
            }
        }

        // Success Callback
        function successCallback(position) {

            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            const time = new Date().toLocaleString();

            const locationData = {
                latitude: latitude,
                longitude: longitude,
                timestamp: time
            };

            document.getElementById("currentLocation").innerHTML =
                "Latitude: " + latitude +
                "<br>Longitude: " + longitude +
                "<br>Time: " + time;

            saveToLocalStorage(locationData);
            displayHistory();
        }

        // Error Callback  function
        function errorCallback(error) {

            let message = "";

            switch(error.code) {

                case error.PERMISSION_DENIED:
                    message = "User denied the request for Geolocation.";
                    break;

                case error.POSITION_UNAVAILABLE:
                    message = "Location information is unavailable.";
                    break;

                case error.TIMEOUT:
                    message = "The request to get user location timed out.";
                    break;

                default:
                    message = "An unknown error occurred.";
            }

            document.getElementById("currentLocation").innerHTML = message;
        }

        function saveToLocalStorage(locationData) {

            let history = JSON.parse(localStorage.getItem("locationHistory")) || []

            localStorage.setItem("locationHistory", JSON.stringify(history));
        }

        function displayHistory() {

            const historyList = document.getElementById("locationHistory");
            historyList.innerHTML = "";

            let history = JSON.parse(localStorage.getItem("locationHistory"));

            if (!history || history.length === 0) {
                historyList.innerHTML = "<li>No location history available</li>";
                return;
            }

            history.forEach(function(item) {
                const li = document.createElement("li");
                li.innerHTML =
                    "Lat: " + item.latitude +
                    ", Lon: " + item.longitude +
                    " (" + item.timestamp + ")";
                historyList.appendChild(li);
            });
        }

        //---Clear LocalStorage
        function clearHistory() {
            localStorage.removeItem("locationHistory");
            displayHistory();
            document.getElementById("currentLocation").innerHTML =
                "Location history cleared.";
        }

    </script>

</body>
</html>